# SmartRenamer UI 使用指南

## 概述

SmartRenamer 提供了完整的图形用户界面（GUI），基于 PySide6 开发，提供直观易用的媒体文件重命名体验。

## 启动应用

```bash
# 方式 1: 直接运行
python src/smartrenamer/main.py

# 方式 2: 使用命令（需先安装）
smartrenamer
```

## 主界面布局

主窗口分为以下几个部分：

### 1. 菜单栏

- **文件(F)**
  - 打开目录(O) - `Ctrl+O`: 打开并扫描媒体目录
  - 退出(X) - `Ctrl+Q`: 退出应用程序

- **编辑(E)**
  - 设置(S) - `Ctrl+,`: 打开设置对话框

- **工具(T)**
  - 匹配选中文件(M) - `Ctrl+M`: 对选中的文件进行 TMDB 匹配
  - 批量重命名(R) - `Ctrl+R`: 执行批量重命名操作
  - 撤销上次重命名(U) - `Ctrl+Z`: 撤销最后的重命名操作

- **帮助(H)**
  - 关于(A): 查看应用程序信息
  - 使用文档(D): 查看快速使用指南

### 2. 工具栏

提供快速访问常用功能的按钮：
- 打开目录
- 匹配
- 重命名
- 撤销
- 设置

### 3. 主内容区（选项卡）

#### 📁 媒体库选项卡

显示和管理媒体文件。

**功能：**
- **扫描目录**: 点击"扫描目录"按钮选择要扫描的文件夹
- **文件夹树**: 左侧显示扫描到的文件夹结构
- **文件列表**: 右侧显示媒体文件详情
  - 文件名
  - 类型（电影/电视剧）
  - 标题
  - 年份
  - 文件大小
  - 状态
  - 路径
- **搜索过滤**: 按标题、路径搜索，按类型过滤
- **多选**: 使用 `Ctrl+点击` 或 `Shift+点击` 选择多个文件
- **匹配选中文件**: 对选中的文件进行 TMDB 匹配

**操作流程：**
1. 点击"扫描目录"按钮
2. 选择包含媒体文件的文件夹
3. 等待扫描完成
4. 在文件列表中选择要处理的文件
5. 点击"匹配选中文件"进行识别

#### 🔍 匹配识别选项卡

显示 TMDB 匹配结果并允许手动选择。

**功能：**
- **匹配结果列表**: 显示从 TMDB 获取的可能匹配项
- **影视详情面板**: 显示选中匹配项的详细信息
  - 海报图片
  - 标题（中文和原文）
  - 年份
  - 类型（电影/电视剧）
  - 匹配度
  - 匹配原因
  - 剧情简介
- **自动匹配**: 自动选择第一个匹配项
- **确认选择**: 确认当前选中的匹配项
- **跳过**: 跳过当前文件

**操作流程：**
1. 从媒体库选项卡选择文件后自动跳转
2. 查看匹配结果列表
3. 点击列表项查看详情
4. 确认正确的匹配项或点击跳过

**注意事项：**
- 高置信度的匹配会自动确认（可在设置中关闭）
- 如果匹配结果不正确，可以手动选择其他项

#### ⚙️ 重命名规则选项卡

配置和预览重命名规则。

**功能：**
- **规则列表**: 
  - 预定义规则（系统自带）
  - 自定义规则（用户创建）
- **规则编辑器**:
  - 规则名称
  - 规则描述
  - Jinja2 模板编辑
  - 示例输出
- **实时预览**: 在预览面板查看应用规则后的效果
- **新建规则**: 创建自定义规则
- **保存规则**: 保存修改后的规则
- **删除规则**: 删除自定义规则（预定义规则不可删除）

**预定义规则：**
1. **电影-简洁**: `标题 (年份).扩展名`
2. **电影-标准**: `标题.年份.分辨率.扩展名`
3. **电影-完整**: `标题.年份.分辨率.来源.编码.扩展名`
4. **电视剧-标准**: `标题 S01E01.扩展名`
5. **电视剧-带剧集名**: `标题 S01E01 剧集名.扩展名`
6. **电视剧-完整**: `标题 S01E01 剧集名 分辨率.扩展名`
7. **电视剧-分季目录**: `标题/Season 01/标题 S01E01.扩展名`

**Jinja2 模板语法：**
```jinja2
{{ title }}          # 标题
{{ year }}           # 年份
{{ season }}         # 季数
{{ episode }}        # 集数
{{ episode_title }}  # 剧集标题
{{ resolution }}     # 分辨率
{{ source }}         # 来源
{{ codec }}          # 编码
```

**自定义过滤器：**
```jinja2
{{ season|pad(2) }}           # 填充为2位数字: 01
{{ title|clean }}             # 清理非法字符
{{ title|truncate(50) }}      # 截断到50字符
{{ title|capitalize }}        # 首字母大写
{{ title|upper }}             # 全大写
{{ title|lower }}             # 全小写
{{ title|default('未知') }}   # 提供默认值
```

**操作流程：**
1. 在规则列表中选择一个规则
2. 查看或编辑 Jinja2 模板
3. 在预览面板查看效果
4. 如需保存修改，点击"保存规则"

#### 📜 历史记录选项卡

查看和管理重命名历史。

**功能：**
- **历史记录表格**: 显示所有重命名操作
  - 时间
  - 原文件名
  - 新文件名
  - 路径
  - 使用的规则
  - 状态（已应用/已撤销）
- **撤销操作**: 撤销选中的重命名操作
- **清空历史**: 清空所有历史记录
- **刷新**: 刷新历史记录列表

**操作流程：**
1. 在历史记录表格中选择要撤销的操作
2. 点击"撤销选中操作"按钮
3. 确认撤销

**注意事项：**
- 只能撤销未被撤销过的操作
- 如果文件已被移动或删除，撤销可能失败
- 清空历史后无法恢复

### 4. 日志面板

位于主内容区下方，显示应用程序操作日志。

**功能：**
- 实时显示操作日志
- 按日志级别着色（INFO、WARNING、ERROR）
- 清空日志按钮

### 5. 状态栏

位于窗口底部，显示当前状态信息和文件计数。

## 设置对话框

通过 `编辑 -> 设置` 或工具栏的设置按钮打开。

### API 配置选项卡

- **API Key**: 输入 TMDB API Key（必需）
  - 获取地址: https://www.themoviedb.org/settings/api
- **语言**: 选择 TMDB API 返回的语言
  - zh-CN (简体中文)
  - en-US (英文)
  - ja-JP (日文)
  - ko-KR (韩文)

### 路径配置选项卡

- **默认扫描路径**: 设置默认的媒体文件扫描目录
- **缓存目录**: 查看缓存文件位置
- **清空缓存**: 清除所有 TMDB API 缓存

### 重命名选项选项卡

- **重命名前创建备份**: 启用后会在重命名前创建历史记录
- **默认启用预览模式**: 启用后重命名操作默认为预览模式
- **自动确认高置信度匹配**: 启用后高相似度匹配会自动确认
- **相似度阈值**: 设置匹配相似度阈值（0.5-0.9）

## 批量重命名工作流

完整的批量重命名流程：

### 步骤 1: 扫描媒体库

1. 点击工具栏的"打开目录"或菜单 `文件 -> 打开目录`
2. 选择包含媒体文件的文件夹
3. 等待扫描完成

### 步骤 2: 选择文件

1. 在媒体库选项卡的文件列表中选择要处理的文件
2. 可以使用搜索和过滤功能
3. 支持多选（Ctrl+点击 或 Shift+点击）

### 步骤 3: TMDB 匹配

1. 点击"匹配选中文件"按钮
2. 切换到匹配识别选项卡
3. 查看匹配结果
4. 确认或手动选择正确的匹配项
5. 对所有需要重命名的文件完成匹配

### 步骤 4: 选择重命名规则

1. 切换到重命名规则选项卡
2. 在规则列表中选择合适的规则
3. 可以编辑模板进行自定义
4. 在预览面板查看效果

### 步骤 5: 执行重命名

1. 点击工具栏的"重命名"或菜单 `工具 -> 批量重命名`
2. 确认重命名操作
3. 查看进度对话框
4. 等待完成并查看结果摘要

### 步骤 6: 撤销（如需要）

1. 切换到历史记录选项卡
2. 选择要撤销的操作
3. 点击"撤销选中操作"
4. 确认撤销

## 快捷键

| 功能 | 快捷键 |
|-----|--------|
| 打开目录 | `Ctrl+O` |
| 匹配选中文件 | `Ctrl+M` |
| 批量重命名 | `Ctrl+R` |
| 撤销 | `Ctrl+Z` |
| 设置 | `Ctrl+,` |
| 退出 | `Ctrl+Q` |

## 常见问题

### Q1: 无法启动 GUI
**A**: 确保已安装 PySide6:
```bash
pip install PySide6
```

### Q2: 匹配功能不可用
**A**: 需要配置 TMDB API Key:
1. 前往 https://www.themoviedb.org/settings/api 获取 API Key
2. 在设置对话框的 API 配置选项卡中输入

### Q3: 扫描找不到文件
**A**: 检查以下几点:
- 确保目录中有支持的媒体文件（.mkv, .mp4, .avi 等）
- 检查文件权限
- 查看日志面板的错误信息

### Q4: 匹配结果不准确
**A**: 可以尝试:
- 手动在匹配结果列表中选择正确的项
- 调整相似度阈值（在设置中）
- 确保文件名包含有用的信息（标题、年份等）

### Q5: 重命名失败
**A**: 可能的原因:
- 文件被其他程序占用
- 没有写入权限
- 目标文件名已存在（需要处理冲突）
- 文件名包含非法字符

### Q6: 如何撤销重命名
**A**: 
1. 切换到历史记录选项卡
2. 选择要撤销的操作（只能撤销"已应用"状态的记录）
3. 点击"撤销选中操作"

## 技术支持

- **文档**: 查看项目的 README.md 和其他指南文档
- **日志**: 查看日志面板或控制台输出
- **问题报告**: 提交 GitHub Issue

## 版本信息

当前版本: v0.5.0

新增功能:
- ✅ 完整的 PySide6 GUI 界面
- ✅ 媒体库浏览和管理
- ✅ TMDB 匹配识别
- ✅ 规则配置和预览
- ✅ 批量重命名
- ✅ 历史记录和撤销
- ✅ 完整中文化
- ✅ 快捷键支持
